<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>2025ë…„ ì¶”ê³„ ê³„ëª¨ì„ ì°¸ì„ í˜„í™©</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <style>
    body { margin: 0; font-family: 'Pretendard', sans-serif; }
    .modal-bg { background: rgba(0,0,0,0.4); }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100">
  <div id="root"></div>

  <script type="text/babel">

    const { useState, useEffect, useRef } = React;

    function App() {
      const [config, setConfig] = useState(() => {
        const saved = localStorage.getItem("firebaseConfig");
        return saved ? JSON.parse(saved) : null;
      });
      const [members, setMembers] = useState([]);
      const [firestore, setFirestore] = useState(null);
      const [showModal, setShowModal] = useState(!config);

      const DEFAULT_MEMBERS = [
        'ì´ê²½ë“','ì´ê²½ë¥ ','ê¹€ì£¼ì‹','ì´ê²½ì„','ë°˜ë³‘ì£¼','ì •ì„±ëŒ€','ì´ê²½í˜¸',
        'ê¹€ê¸ˆìˆœ','ì´ì¬ì„±','ì´ë™ê´€','í•œì„ì›','ê°•ì–‘ìˆ˜','í™©ë‘í˜¸','ì´ì„±ê·¼','ì´ê²½ìˆ˜','ì´ê²½ì² '
      ].map((n,i)=>({ id:i+1, name:n, attendance:'', count:'', locked:false }));

      useEffect(() => {
        if (!config) return;
        try {
          if (!firebase.apps.length) firebase.initializeApp(config);
          const auth = firebase.auth();
          const fs = firebase.firestore();
          setFirestore(fs);
          auth.signInAnonymously();
        } catch (e) { console.error(e); }
      }, [config]);

      useEffect(() => {
        if (!firestore) { setMembers(DEFAULT_MEMBERS); return; }
        const ref = firestore.collection("attendance_2025").doc("autumn");
        ref.onSnapshot(doc => {
          if (doc.exists) setMembers(doc.data().members);
          else ref.set({ members: DEFAULT_MEMBERS });
        });
      }, [firestore]);

      const updateMember = (id, field, value) => {
        const updated = members.map(m => m.id === id ? { ...m, [field]: value } : m);
        setMembers(updated);
        if (firestore)
          firestore.collection("attendance_2025").doc("autumn").update({ members: updated });
      };

      const total = members.reduce((s,m)=> s + (parseInt(m.count)||0),0);
      const attending = members.filter(m=>m.attendance==='ì°¸ì„').length;
      const notAttending = members.filter(m=>m.attendance==='ë¶ˆì°¸').length;
      const pending = members.filter(m=>!m.attendance).length;

      const [input, setInput] = useState({
        apiKey:'', authDomain:'', projectId:'', storageBucket:'', messagingSenderId:'', appId:''
      });

      const saveConfig = () => {
        localStorage.setItem("firebaseConfig", JSON.stringify(input));
        setConfig(input);
        setShowModal(false);
        location.reload();
      };

      const resetConfig = () => {
        localStorage.removeItem("firebaseConfig");
        setShowModal(true);
      };

      return (
        <div className="p-4 max-w-4xl mx-auto">
          {/* Header */}
          <div className="bg-white rounded-2xl shadow-lg p-4 flex justify-between items-center mb-4">
            <div>
              <h1 className="text-2xl font-bold text-gray-800 flex items-center gap-2">
                ğŸ“… 2025ë…„ ì¶”ê³„ ê³„ëª¨ì„
              </h1>
              <p className="text-gray-600 text-sm">ëª¨ì„ì¼ì‹œ : 2025. 11. 22(í† ) 12:00</p>
            </div>
            <button onClick={resetConfig} className="text-sm bg-gray-200 px-3 py-1 rounded-md hover:bg-gray-300">âš™ï¸ ì„¤ì •</button>
          </div>

          {/* Stats */}
          <div className="grid grid-cols-3 gap-2 text-center mb-4 text-sm sm:text-base">
            <div className="bg-green-100 p-2 rounded-lg font-bold text-green-700">ì°¸ì„ {attending}ëª…</div>
            <div className="bg-red-100 p-2 rounded-lg font-bold text-red-700">ë¶ˆì°¸ {notAttending}ëª…</div>
            <div className="bg-gray-100 p-2 rounded-lg font-bold text-gray-700">ë¯¸ì‘ë‹µ {pending}ëª…</div>
          </div>

          <div className="text-right text-indigo-700 mb-2 font-semibold">ğŸ‘¥ ì´ ì°¸ì„ ì¸ì›: {total}ëª…</div>

          {/* Table */}
          <div className="bg-white rounded-2xl shadow-lg overflow-hidden">
            <table className="w-full text-sm sm:text-base">
              <thead className="bg-indigo-600 text-white">
                <tr>
                  <th className="p-2">ë²ˆí˜¸</th>
                  <th className="p-2">ì´ë¦„</th>
                  <th className="p-2">ì°¸ì„</th>
                  <th className="p-2">ì¸ì›</th>
                  <th className="p-2">í™•ì¸</th>
                </tr>
              </thead>
              <tbody>
                {members.map((m, i) => (
                  <tr key={m.id} className="border-b text-center hover:bg-gray-50">
                    <td>{i+1}</td>
                    <td>{m.name}</td>
                    <td>
                      <select
                        value={m.attendance}
                        onChange={e=>updateMember(m.id,'attendance',e.target.value)}
                        className="border rounded px-2 py-1"
                      >
                        <option value="">ì„ íƒ</option>
                        <option value="ì°¸ì„">ì°¸ì„</option>
                        <option value="ë¶ˆì°¸">ë¶ˆì°¸</option>
                      </select>
                    </td>
                    <td>
                      <input
                        type="number"
                        min="1"
                        value={m.count}
                        disabled={m.attendance!=='ì°¸ì„'||m.locked}
                        onChange={e=>updateMember(m.id,'count',e.target.value)}
                        className="border rounded w-16 text-center"
                      />
                    </td>
                    <td>
                      {!m.locked ? (
                        <button onClick={()=>updateMember(m.id,'locked',true)} className="bg-green-500 text-white px-2 py-1 rounded">í™•ì¸</button>
                      ):(
                        <button onClick={()=>updateMember(m.id,'locked',false)} className="bg-yellow-500 text-white px-2 py-1 rounded">ìˆ˜ì •</button>
                      )}
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>

          {showModal && (
            <div className="fixed inset-0 flex items-center justify-center modal-bg">
              <div className="bg-white rounded-2xl shadow-2xl p-6 w-96">
                <h2 className="text-xl font-bold mb-4">Firebase ì„¤ì • (1íšŒë§Œ)</h2>
                <p className="text-gray-600 text-sm mb-4">Firebase ì½˜ì†” â†’ ì›¹ ì•± ì¶”ê°€ â†’ êµ¬ì„± ê°’ì„ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.</p>
                {Object.keys(input).map(k=>(
                  <div key={k} className="mb-2">
                    <label className="block text-sm font-semibold text-gray-700">{k}</label>
                    <input className="border rounded w-full p-1" value={input[k]} onChange={e=>setInput({...input,[k]:e.target.value})}/>
                  </div>
                ))}
                <div className="flex justify-end gap-2 mt-4">
                  <button onClick={()=>setShowModal(false)} className="px-3 py-1 bg-yellow-100 rounded">ë‚˜ì¤‘ì—</button>
                  <button onClick={saveConfig} className="px-3 py-1 bg-indigo-600 text-white rounded">ì €ì¥</button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));

  </script>
</body>
</html>
